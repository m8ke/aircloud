<nav class="flex items-center max-md:w-full max-md:justify-between px-6 py-4 text-white text-sm backdrop-blur">
    <div class="flex flex-row items-center">
        <div routerLink="/" class="cursor-pointer">
            <img ngSrc="/aircloud-white.svg" alt="AirCloud" [width]="100" [height]="20.5">
        </div>

        <div class="bg-white border text-black rounded-2xl px-2 py-1 ms-2 text-xs">
            <p>Beta</p>
        </div>
    </div>

    <div class="flex justify-end items-center grow-1">
        <div class="ms-4 md:flex items-center gap-2">
            <button
                (click)="modalConnectWithPeer()?.open()"
                class="cursor-pointer flex flex-row gap-x-1 items-center bg-white shadow-white/50 text-black px-3.5 py-2 text-sm font-medium hover:bg-slate-100 rounded-xl transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="size-4">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"/>
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z"/>
                </svg>

                <span>Connect</span>
            </button>
        </div>
    </div>
</nav>

<app-modal #modalConnectWithPeerRef [isWarning]="true" (onCancel)="closeCamera()">
    <h3
        class="text-xl font-semibold text-gray-900 font-serif"
        slot="header">
        Connect with peer
    </h3>

    <div class="mt-5 flex gap-y-2 flex-col">
        @if (state == "camera") {
            <p class="mb-2">
                Scan the other peer's QR code to connect
            </p>
        }

        <video #videoRef [hidden]="true" class="bg-black w-full aspect-1/1 rounded-xl"></video>
        <canvas #canvasRef [hidden]="true"></canvas>

        @switch (state) {
            @case ("qr") {
                <div class="flex flex-col gap-y-3">
                    <p>
                        Share link or QR code to connect with other peers
                    </p>

                    <div class="flex flex-row items-center justify-around bg-zinc-100 rounded-xl w-full ps-4 pe-2 py-2">
                        <p class="text-2xl font-bold tracking-wider grow-1">
                            {{ session.connectionId }}
                        </p>

                        <div class="flex flex-row items-center gap-x-1">
                            <div
                                [copyClipboard]="session.connectionId"
                                copiedText="Copied!"
                                [duration]="3000"
                                class="cursor-pointer font-medium rounded-lg px-2.5 py-1.5 text-xs text-black bg-zinc-300 hover:bg-zinc-400 transition duration-300">
                                Copy code
                            </div>

                            <div
                                [copyClipboard]="directConnectionUrl"
                                copiedText="Copied!"
                                [duration]="3000"
                                class="cursor-pointer font-medium rounded-lg px-2.5 py-1.5 text-xs text-black bg-zinc-300 hover:bg-zinc-400 transition duration-300">
                                Copy link
                            </div>
                        </div>
                    </div>

                    <div class="w-full bg-black rounded-xl p-5">
                        <qrcode
                            [qrdata]="directConnectionUrl"
                            class="w-full"
                            [elementType]="'svg'"
                            [allowEmptyString]="true"
                            [cssClass]="'[&>svg]:w-full [&>svg]:h-full'"
                            [errorCorrectionLevel]="'H'"
                            [scale]="1"
                            [version]="10"
                            [margin]="0"
                            colorDark="#fff"
                            colorLight="#000"
                        />
                    </div>
                </div>

                <button
                    (click)="openCamera()"
                    class="cursor-pointer rounded-xl bg-indigo-500 px-2.5 py-2.5 w-full text-sm text-white hover:bg-indigo-600 transition duration-300">
                    Scan the other's peer QR code
                </button>

                <button
                    (click)="state = 'manual'"
                    class="cursor-pointer rounded-xl border border-zinc-300 text-black bg-white px-2.5 py-2.5 w-full text-sm hover:bg-zinc-100 transition duration-300">
                    Connect manually via unique code
                </button>
            }
            @case ("camera") {
                <button
                    (click)="closeCamera()"
                    class="cursor-pointer rounded-xl bg-indigo-500 px-2.5 py-2.5 w-full text-sm text-white hover:bg-indigo-600 transition duration-300">
                    Cancel
                </button>
            }
            @case ("manual") {
                <p>
                    Connection ID from another device to connect with peer
                </p>

                <form
                    [formGroup]="formJoinPeer"
                    (submit)="onConnectPeer()">
                    <input
                        id="connectionId"
                        type="text"
                        autocomplete="off"
                        formControlName="connectionId"
                        placeholder="Code from another peer's device"
                        [maxLength]="255"
                        class="block mb-3 w-full rounded-xl bg-white/5 px-3 py-2.5 text-sm text-black outline-1 -outline-offset-1 outline-black/10 placeholder:text-zinc-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500"
                    />

                    <button
                        type="submit"
                        [disabled]="formJoinPeer.invalid"
                        class="cursor-pointer rounded-xl bg-indigo-500 px-2.5 py-2.5 w-full text-sm text-white hover:bg-indigo-600 transition duration-300">
                        Connect now
                    </button>
                </form>

                <button
                    (click)="state = 'qr'"
                    class="cursor-pointer rounded-xl border border-zinc-300 text-black bg-white px-2.5 py-2.5 w-full text-sm hover:bg-zinc-100 transition duration-300">
                    Show QR code
                </button>
            }
        }
    </div>
</app-modal>
